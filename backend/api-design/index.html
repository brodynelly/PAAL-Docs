
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://brodynelly.github.io/PAAL-Docs/backend/api-design/">
      
      
        <link rel="prev" href="../service-decomposition/">
      
      
        <link rel="next" href="../data-access/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.12">
    
    
      
        <title>API Design - PAAL Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2afb09e1.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api-design-and-documentation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="PAAL Documentation" class="md-header__button md-logo" aria-label="PAAL Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PAAL Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API Design
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="PAAL Documentation" class="md-nav__button md-logo" aria-label="PAAL Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    PAAL Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gettingstarted/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Frontend
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Frontend
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../frontend/overall-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overall Architecture
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../frontend/key-components/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Key Components and Structure
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../frontend/api-interactions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Interactions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../frontend/state-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    State Management
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Backend
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Backend
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../overall-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overall Architecture
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../service-decomposition/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Services Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    API Design
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    API Design
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-design-principles" class="md-nav__link">
    <span class="md-ellipsis">
      API Design Principles
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API Design Principles">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-restful-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      1. RESTful Architecture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-json-format" class="md-nav__link">
    <span class="md-ellipsis">
      2. JSON Format
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-consistent-response-structure" class="md-nav__link">
    <span class="md-ellipsis">
      3. Consistent Response Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-proper-http-status-codes" class="md-nav__link">
    <span class="md-ellipsis">
      4. Proper HTTP Status Codes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-authentication-required" class="md-nav__link">
    <span class="md-ellipsis">
      5. Authentication Required
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-role-based-access-control" class="md-nav__link">
    <span class="md-ellipsis">
      6. Role-Based Access Control
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-pagination" class="md-nav__link">
    <span class="md-ellipsis">
      7. Pagination
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-filtering-and-sorting" class="md-nav__link">
    <span class="md-ellipsis">
      8. Filtering and Sorting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9-versioning" class="md-nav__link">
    <span class="md-ellipsis">
      9. Versioning
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10-rate-limiting" class="md-nav__link">
    <span class="md-ellipsis">
      10. Rate Limiting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#11-comprehensive-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      11. Comprehensive Documentation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#base-url" class="md-nav__link">
    <span class="md-ellipsis">
      Base URL
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authentication" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Authentication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authentication-mechanism" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication Mechanism
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Authentication Mechanism">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authentication-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication Flow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#token-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Token Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#token-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Token Usage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#token-expiration-and-refresh" class="md-nav__link">
    <span class="md-ellipsis">
      Token Expiration and Refresh
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#token-refresh-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Token Refresh Flow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Security Considerations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-details" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation Details
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentication-endpoints" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication Endpoints
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Authentication Endpoints">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#login" class="md-nav__link">
    <span class="md-ellipsis">
      Login
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Login">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#request-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Request Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Response Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-responses" class="md-nav__link">
    <span class="md-ellipsis">
      Error Responses
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-notes" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation Notes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#code-example" class="md-nav__link">
    <span class="md-ellipsis">
      Code Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verify-token" class="md-nav__link">
    <span class="md-ellipsis">
      Verify Token
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-management-api" class="md-nav__link">
    <span class="md-ellipsis">
      User Management API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="User Management API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-all-users" class="md-nav__link">
    <span class="md-ellipsis">
      Get All Users
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-user-by-id" class="md-nav__link">
    <span class="md-ellipsis">
      Get User by ID
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-user" class="md-nav__link">
    <span class="md-ellipsis">
      Create User
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-user" class="md-nav__link">
    <span class="md-ellipsis">
      Update User
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-user" class="md-nav__link">
    <span class="md-ellipsis">
      Delete User
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#farm-management-api" class="md-nav__link">
    <span class="md-ellipsis">
      Farm Management API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Farm Management API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-all-farms" class="md-nav__link">
    <span class="md-ellipsis">
      Get All Farms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-farm-by-id" class="md-nav__link">
    <span class="md-ellipsis">
      Get Farm by ID
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-farm" class="md-nav__link">
    <span class="md-ellipsis">
      Create Farm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-farm" class="md-nav__link">
    <span class="md-ellipsis">
      Update Farm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-farm" class="md-nav__link">
    <span class="md-ellipsis">
      Delete Farm
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pig-management-api" class="md-nav__link">
    <span class="md-ellipsis">
      Pig Management API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pig Management API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-all-pigs" class="md-nav__link">
    <span class="md-ellipsis">
      Get All Pigs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-pig-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Get Pig Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-pig-by-id" class="md-nav__link">
    <span class="md-ellipsis">
      Get Pig by ID
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-pig-posture-data" class="md-nav__link">
    <span class="md-ellipsis">
      Get Pig Posture Data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-pig" class="md-nav__link">
    <span class="md-ellipsis">
      Create Pig
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#statistics-api" class="md-nav__link">
    <span class="md-ellipsis">
      Statistics API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Statistics API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-system-statistics" class="md-nav__link">
    <span class="md-ellipsis">
      Get System Statistics
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#activity-logging-api" class="md-nav__link">
    <span class="md-ellipsis">
      Activity Logging API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Activity Logging API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-recent-activities" class="md-nav__link">
    <span class="md-ellipsis">
      Get Recent Activities
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-upload-api" class="md-nav__link">
    <span class="md-ellipsis">
      Data Upload API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Data Upload API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#upload-posture-data" class="md-nav__link">
    <span class="md-ellipsis">
      Upload Posture Data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#real-time-communication" class="md-nav__link">
    <span class="md-ellipsis">
      Real-time Communication
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Real-time Communication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#socketio-events" class="md-nav__link">
    <span class="md-ellipsis">
      Socket.IO Events
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Socket.IO Events">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#connection" class="md-nav__link">
    <span class="md-ellipsis">
      Connection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stats-update" class="md-nav__link">
    <span class="md-ellipsis">
      Stats Update
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activity-update" class="md-nav__link">
    <span class="md-ellipsis">
      Activity Update
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rate-limiting" class="md-nav__link">
    <span class="md-ellipsis">
      Rate Limiting
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Error Handling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#error-response-format" class="md-nav__link">
    <span class="md-ellipsis">
      Error Response Format
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Error Response Format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#error-response-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Error Response Fields
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http-status-codes" class="md-nav__link">
    <span class="md-ellipsis">
      HTTP Status Codes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-codes" class="md-nav__link">
    <span class="md-ellipsis">
      Error Codes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Error Codes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authentication-errors" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication Errors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validation-errors" class="md-nav__link">
    <span class="md-ellipsis">
      Validation Errors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-errors" class="md-nav__link">
    <span class="md-ellipsis">
      Resource Errors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rate-limiting-errors" class="md-nav__link">
    <span class="md-ellipsis">
      Rate Limiting Errors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server-errors" class="md-nav__link">
    <span class="md-ellipsis">
      Server Errors
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-handling-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling Implementation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Error Handling Implementation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#error-middleware" class="md-nav__link">
    <span class="md-ellipsis">
      Error Middleware
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-error-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Custom Error Classes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usage-in-route-handlers" class="md-nav__link">
    <span class="md-ellipsis">
      Usage in Route Handlers
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-logging-and-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      Error Logging and Monitoring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#client-side-error-handling-recommendations" class="md-nav__link">
    <span class="md-ellipsis">
      Client-Side Error Handling Recommendations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-error-responses" class="md-nav__link">
    <span class="md-ellipsis">
      Example Error Responses
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Example Error Responses">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#validation-error-422-unprocessable-entity" class="md-nav__link">
    <span class="md-ellipsis">
      Validation Error (422 Unprocessable Entity)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-not-found-404-not-found" class="md-nav__link">
    <span class="md-ellipsis">
      Resource Not Found (404 Not Found)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentication-error-401-unauthorized" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication Error (401 Unauthorized)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rate-limit-error-429-too-many-requests" class="md-nav__link">
    <span class="md-ellipsis">
      Rate Limit Error (429 Too Many Requests)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-versioning" class="md-nav__link">
    <span class="md-ellipsis">
      API Versioning
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cross-origin-resource-sharing-cors" class="md-nav__link">
    <span class="md-ellipsis">
      Cross-Origin Resource Sharing (CORS)
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../data-access/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Data Access Layer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security-measures/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Security Measures
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-design-principles" class="md-nav__link">
    <span class="md-ellipsis">
      API Design Principles
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API Design Principles">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-restful-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      1. RESTful Architecture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-json-format" class="md-nav__link">
    <span class="md-ellipsis">
      2. JSON Format
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-consistent-response-structure" class="md-nav__link">
    <span class="md-ellipsis">
      3. Consistent Response Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-proper-http-status-codes" class="md-nav__link">
    <span class="md-ellipsis">
      4. Proper HTTP Status Codes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-authentication-required" class="md-nav__link">
    <span class="md-ellipsis">
      5. Authentication Required
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-role-based-access-control" class="md-nav__link">
    <span class="md-ellipsis">
      6. Role-Based Access Control
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-pagination" class="md-nav__link">
    <span class="md-ellipsis">
      7. Pagination
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-filtering-and-sorting" class="md-nav__link">
    <span class="md-ellipsis">
      8. Filtering and Sorting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9-versioning" class="md-nav__link">
    <span class="md-ellipsis">
      9. Versioning
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10-rate-limiting" class="md-nav__link">
    <span class="md-ellipsis">
      10. Rate Limiting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#11-comprehensive-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      11. Comprehensive Documentation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#base-url" class="md-nav__link">
    <span class="md-ellipsis">
      Base URL
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authentication" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Authentication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authentication-mechanism" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication Mechanism
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Authentication Mechanism">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authentication-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication Flow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#token-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Token Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#token-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Token Usage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#token-expiration-and-refresh" class="md-nav__link">
    <span class="md-ellipsis">
      Token Expiration and Refresh
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#token-refresh-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Token Refresh Flow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Security Considerations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-details" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation Details
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentication-endpoints" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication Endpoints
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Authentication Endpoints">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#login" class="md-nav__link">
    <span class="md-ellipsis">
      Login
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Login">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#request-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Request Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Response Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-responses" class="md-nav__link">
    <span class="md-ellipsis">
      Error Responses
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-notes" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation Notes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#code-example" class="md-nav__link">
    <span class="md-ellipsis">
      Code Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verify-token" class="md-nav__link">
    <span class="md-ellipsis">
      Verify Token
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-management-api" class="md-nav__link">
    <span class="md-ellipsis">
      User Management API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="User Management API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-all-users" class="md-nav__link">
    <span class="md-ellipsis">
      Get All Users
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-user-by-id" class="md-nav__link">
    <span class="md-ellipsis">
      Get User by ID
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-user" class="md-nav__link">
    <span class="md-ellipsis">
      Create User
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-user" class="md-nav__link">
    <span class="md-ellipsis">
      Update User
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-user" class="md-nav__link">
    <span class="md-ellipsis">
      Delete User
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#farm-management-api" class="md-nav__link">
    <span class="md-ellipsis">
      Farm Management API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Farm Management API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-all-farms" class="md-nav__link">
    <span class="md-ellipsis">
      Get All Farms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-farm-by-id" class="md-nav__link">
    <span class="md-ellipsis">
      Get Farm by ID
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-farm" class="md-nav__link">
    <span class="md-ellipsis">
      Create Farm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-farm" class="md-nav__link">
    <span class="md-ellipsis">
      Update Farm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-farm" class="md-nav__link">
    <span class="md-ellipsis">
      Delete Farm
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pig-management-api" class="md-nav__link">
    <span class="md-ellipsis">
      Pig Management API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pig Management API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-all-pigs" class="md-nav__link">
    <span class="md-ellipsis">
      Get All Pigs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-pig-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Get Pig Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-pig-by-id" class="md-nav__link">
    <span class="md-ellipsis">
      Get Pig by ID
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-pig-posture-data" class="md-nav__link">
    <span class="md-ellipsis">
      Get Pig Posture Data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-pig" class="md-nav__link">
    <span class="md-ellipsis">
      Create Pig
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#statistics-api" class="md-nav__link">
    <span class="md-ellipsis">
      Statistics API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Statistics API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-system-statistics" class="md-nav__link">
    <span class="md-ellipsis">
      Get System Statistics
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#activity-logging-api" class="md-nav__link">
    <span class="md-ellipsis">
      Activity Logging API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Activity Logging API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-recent-activities" class="md-nav__link">
    <span class="md-ellipsis">
      Get Recent Activities
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-upload-api" class="md-nav__link">
    <span class="md-ellipsis">
      Data Upload API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Data Upload API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#upload-posture-data" class="md-nav__link">
    <span class="md-ellipsis">
      Upload Posture Data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#real-time-communication" class="md-nav__link">
    <span class="md-ellipsis">
      Real-time Communication
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Real-time Communication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#socketio-events" class="md-nav__link">
    <span class="md-ellipsis">
      Socket.IO Events
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Socket.IO Events">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#connection" class="md-nav__link">
    <span class="md-ellipsis">
      Connection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stats-update" class="md-nav__link">
    <span class="md-ellipsis">
      Stats Update
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activity-update" class="md-nav__link">
    <span class="md-ellipsis">
      Activity Update
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rate-limiting" class="md-nav__link">
    <span class="md-ellipsis">
      Rate Limiting
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Error Handling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#error-response-format" class="md-nav__link">
    <span class="md-ellipsis">
      Error Response Format
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Error Response Format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#error-response-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Error Response Fields
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http-status-codes" class="md-nav__link">
    <span class="md-ellipsis">
      HTTP Status Codes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-codes" class="md-nav__link">
    <span class="md-ellipsis">
      Error Codes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Error Codes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authentication-errors" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication Errors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validation-errors" class="md-nav__link">
    <span class="md-ellipsis">
      Validation Errors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-errors" class="md-nav__link">
    <span class="md-ellipsis">
      Resource Errors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rate-limiting-errors" class="md-nav__link">
    <span class="md-ellipsis">
      Rate Limiting Errors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server-errors" class="md-nav__link">
    <span class="md-ellipsis">
      Server Errors
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-handling-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling Implementation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Error Handling Implementation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#error-middleware" class="md-nav__link">
    <span class="md-ellipsis">
      Error Middleware
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-error-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Custom Error Classes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usage-in-route-handlers" class="md-nav__link">
    <span class="md-ellipsis">
      Usage in Route Handlers
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-logging-and-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      Error Logging and Monitoring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#client-side-error-handling-recommendations" class="md-nav__link">
    <span class="md-ellipsis">
      Client-Side Error Handling Recommendations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-error-responses" class="md-nav__link">
    <span class="md-ellipsis">
      Example Error Responses
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Example Error Responses">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#validation-error-422-unprocessable-entity" class="md-nav__link">
    <span class="md-ellipsis">
      Validation Error (422 Unprocessable Entity)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-not-found-404-not-found" class="md-nav__link">
    <span class="md-ellipsis">
      Resource Not Found (404 Not Found)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentication-error-401-unauthorized" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication Error (401 Unauthorized)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rate-limit-error-429-too-many-requests" class="md-nav__link">
    <span class="md-ellipsis">
      Rate Limit Error (429 Too Many Requests)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-versioning" class="md-nav__link">
    <span class="md-ellipsis">
      API Versioning
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cross-origin-resource-sharing-cors" class="md-nav__link">
    <span class="md-ellipsis">
      Cross-Origin Resource Sharing (CORS)
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="api-design-and-documentation">API Design and Documentation<a class="headerlink" href="#api-design-and-documentation" title="Permanent link">&para;</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>The backend utilizes RESTful API that allows clients to interact with the system's resources. This document details the API design principles, authentication mechanisms, endpoint specifications, and implementation details to serve as a complete reference for developers working with the API.</p>
<h2 id="api-design-principles">API Design Principles<a class="headerlink" href="#api-design-principles" title="Permanent link">&para;</a></h2>
<p>The API follows these key design principles to ensure consistency, reliability, and maintainability:</p>
<h3 id="1-restful-architecture">1. RESTful Architecture<a class="headerlink" href="#1-restful-architecture" title="Permanent link">&para;</a></h3>
<p>Resources are represented as URLs, and standard HTTP methods are used for operations:</p>
<ul>
<li><strong>GET</strong>: Retrieve a resource or collection of resources</li>
<li><strong>POST</strong>: Create a new resource</li>
<li><strong>PUT</strong>: Update an existing resource (full update)</li>
<li><strong>PATCH</strong>: Partially update an existing resource</li>
<li><strong>DELETE</strong>: Remove a resource</li>
</ul>
<p>Example resource hierarchy:</p>
<div class="codehilite"><pre><span></span><code>/farms                  # Collection of farms
/farms/{id}             # Specific farm
/farms/{id}/barns       # Collection of barns in a farm
/farms/{id}/barns/{id}  # Specific barn in a farm
</code></pre></div>

<h3 id="2-json-format">2. JSON Format<a class="headerlink" href="#2-json-format" title="Permanent link">&para;</a></h3>
<p>All requests and responses use JSON format for data exchange:</p>
<ul>
<li>Request bodies must use <code>Content-Type: application/json</code></li>
<li>Responses are returned with <code>Content-Type: application/json</code></li>
<li>Date fields use ISO 8601 format (e.g., <code>2023-06-15T10:30:45.123Z</code>)</li>
<li>Numeric IDs are represented as strings when used as resource identifiers</li>
</ul>
<h3 id="3-consistent-response-structure">3. Consistent Response Structure<a class="headerlink" href="#3-consistent-response-structure" title="Permanent link">&para;</a></h3>
<p>Responses follow a consistent structure for both success and error cases:</p>
<p><strong>Success Responses</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Resource data or collection</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;meta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Metadata about the response (pagination, etc.)</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Error Responses</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;error&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;code&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ERROR_CODE&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Human-readable error message&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;details&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="c1">// Optional additional error details</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="4-proper-http-status-codes">4. Proper HTTP Status Codes<a class="headerlink" href="#4-proper-http-status-codes" title="Permanent link">&para;</a></h3>
<p>Appropriate HTTP status codes are used to indicate the result of operations:</p>
<table>
<thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>200</td>
<td>OK</td>
<td>Successful GET, PUT, PATCH, or DELETE</td>
</tr>
<tr>
<td>201</td>
<td>Created</td>
<td>Successful resource creation (POST)</td>
</tr>
<tr>
<td>204</td>
<td>No Content</td>
<td>Successful operation with no response body</td>
</tr>
<tr>
<td>400</td>
<td>Bad Request</td>
<td>Invalid request format or parameters</td>
</tr>
<tr>
<td>401</td>
<td>Unauthorized</td>
<td>Missing or invalid authentication</td>
</tr>
<tr>
<td>403</td>
<td>Forbidden</td>
<td>Authentication succeeded but insufficient permissions</td>
</tr>
<tr>
<td>404</td>
<td>Not Found</td>
<td>Resource not found</td>
</tr>
<tr>
<td>409</td>
<td>Conflict</td>
<td>Request conflicts with current state (e.g., duplicate)</td>
</tr>
<tr>
<td>422</td>
<td>Unprocessable Entity</td>
<td>Validation errors</td>
</tr>
<tr>
<td>429</td>
<td>Too Many Requests</td>
<td>Rate limit exceeded</td>
</tr>
<tr>
<td>500</td>
<td>Internal Server Error</td>
<td>Server-side error</td>
</tr>
</tbody>
</table>
<h3 id="5-authentication-required">5. Authentication Required<a class="headerlink" href="#5-authentication-required" title="Permanent link">&para;</a></h3>
<p>Most endpoints require authentication via JWT:</p>
<ul>
<li>Tokens are obtained through the authentication endpoints</li>
<li>Tokens must be included in the <code>Authorization</code> header</li>
<li>Token expiration and refresh mechanisms are implemented</li>
<li>Sensitive operations require re-authentication</li>
</ul>
<h3 id="6-role-based-access-control">6. Role-Based Access Control<a class="headerlink" href="#6-role-based-access-control" title="Permanent link">&para;</a></h3>
<p>Endpoints enforce appropriate authorization based on user roles:</p>
<table>
<thead>
<tr>
<th>Role</th>
<th>Description</th>
<th>Access Level</th>
</tr>
</thead>
<tbody>
<tr>
<td>Admin</td>
<td>System administrator</td>
<td>Full access to all resources</td>
</tr>
<tr>
<td>Manager</td>
<td>Farm manager</td>
<td>Access to assigned farms and all their resources</td>
</tr>
<tr>
<td>Farmer</td>
<td>Farm worker</td>
<td>Limited access to assigned farms</td>
</tr>
<tr>
<td>Viewer</td>
<td>Read-only user</td>
<td>Read-only access to assigned resources</td>
</tr>
</tbody>
</table>
<h3 id="7-pagination">7. Pagination<a class="headerlink" href="#7-pagination" title="Permanent link">&para;</a></h3>
<p>Large result sets are paginated to improve performance:</p>
<ul>
<li>Default page size is 20 items</li>
<li>Maximum page size is 100 items</li>
<li>Pagination parameters: <code>page</code> (1-based) and <code>limit</code></li>
<li>Pagination metadata is included in the response</li>
</ul>
<p>Example pagination metadata:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;meta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;pagination&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;page&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;limit&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;totalItems&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">156</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;totalPages&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;hasNextPage&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;hasPrevPage&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="8-filtering-and-sorting">8. Filtering and Sorting<a class="headerlink" href="#8-filtering-and-sorting" title="Permanent link">&para;</a></h3>
<p>Resources can be filtered and sorted using query parameters:</p>
<ul>
<li>Filtering: <code>?field=value</code> or <code>?field[operator]=value</code></li>
<li>Sorting: <code>?sort=field</code> (ascending) or <code>?sort=-field</code> (descending)</li>
<li>Multiple filters and sorts can be combined</li>
<li>Complex filtering uses JSON-encoded filter objects</li>
</ul>
<p>Example filtering and sorting:</p>
<div class="codehilite"><pre><span></span><code><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">pigs</span><span class="vm">?</span><span class="n">breed</span><span class="o">=</span><span class="n">Yorkshire</span><span class="o">&amp;</span><span class="n">age</span><span class="o">[</span><span class="n">gte</span><span class="o">]=</span><span class="mi">12</span><span class="o">&amp;</span><span class="n">sort</span><span class="o">=-</span><span class="n">updatedAt</span>
</code></pre></div>

<h3 id="9-versioning">9. Versioning<a class="headerlink" href="#9-versioning" title="Permanent link">&para;</a></h3>
<p>API versioning is supported through URL paths:</p>
<ul>
<li>Current version: v1 (implicit in base URL)</li>
<li>Future versions will use explicit versioning: <code>/api/v2/...</code></li>
<li>Version changes are documented in the API changelog</li>
<li>Multiple versions may be supported simultaneously during transitions</li>
</ul>
<h3 id="10-rate-limiting">10. Rate Limiting<a class="headerlink" href="#10-rate-limiting" title="Permanent link">&para;</a></h3>
<p>API endpoints are protected by rate limiting:</p>
<ul>
<li>Rate limits vary by endpoint sensitivity</li>
<li>Rate limit headers are included in responses</li>
<li>Exceeding rate limits results in 429 responses</li>
<li>Backoff strategies are recommended for clients</li>
</ul>
<p>Rate limit headers:</p>
<div class="codehilite"><pre><span></span><code>X-RateLimit-Limit: 100
X-RateLimit-Remaining: 95
X-RateLimit-Reset: 1623760500
</code></pre></div>

<h3 id="11-comprehensive-documentation">11. Comprehensive Documentation<a class="headerlink" href="#11-comprehensive-documentation" title="Permanent link">&para;</a></h3>
<p>All API endpoints are thoroughly documented:</p>
<ul>
<li>OpenAPI/Swagger specifications</li>
<li>Request/response examples</li>
<li>Authentication requirements</li>
<li>Error scenarios</li>
<li>Rate limiting information</li>
</ul>
<h2 id="base-url">Base URL<a class="headerlink" href="#base-url" title="Permanent link">&para;</a></h2>
<p>The base URL for all API endpoints is:</p>
<div class="codehilite"><pre><span></span><code>http://localhost:8080/api
</code></pre></div>

<p>In production environments, this would be replaced with the appropriate domain.</p>
<h2 id="authentication">Authentication<a class="headerlink" href="#authentication" title="Permanent link">&para;</a></h2>
<h3 id="authentication-mechanism">Authentication Mechanism<a class="headerlink" href="#authentication-mechanism" title="Permanent link">&para;</a></h3>
<p>The API uses JSON Web Tokens (JWT) for authentication, providing a stateless, secure method for authenticating API requests. This section details the complete authentication flow, token structure, and security considerations.</p>
<h4 id="authentication-flow">Authentication Flow<a class="headerlink" href="#authentication-flow" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>Client Authentication</strong>: Client submits credentials to the <code>/api/auth/login</code> endpoint</li>
<li><strong>Server Validation</strong>: Server validates credentials against the database</li>
<li><strong>Token Generation</strong>: Server generates a JWT token containing user information and permissions</li>
<li><strong>Token Response</strong>: Server returns the token to the client</li>
<li><strong>Token Storage</strong>: Client stores the token (typically in localStorage or secure cookie)</li>
<li><strong>Authenticated Requests</strong>: Client includes the token in the <code>Authorization</code> header of subsequent requests</li>
<li><strong>Token Verification</strong>: Server verifies the token signature and expiration</li>
<li><strong>Authorization</strong>: Server checks user permissions for the requested resource</li>
<li><strong>Response</strong>: Server returns the requested resource or an error</li>
</ol>
<h4 id="token-structure">Token Structure<a class="headerlink" href="#token-structure" title="Permanent link">&para;</a></h4>
<p>The JWT token consists of three parts: header, payload, and signature.</p>
<p><strong>Header</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;alg&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;HS256&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;typ&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;JWT&quot;</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Payload</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c85&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user@example.com&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;role&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;admin&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;permissions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;read:farms&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;write:pigs&quot;</span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;iat&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1623760500</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;exp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1623846900</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Signature</strong>:
The signature is created by encoding the header and payload with a secret key.</p>
<h4 id="token-usage">Token Usage<a class="headerlink" href="#token-usage" title="Permanent link">&para;</a></h4>
<p>To access protected endpoints, clients must include the token in the <code>Authorization</code> header:</p>
<div class="codehilite"><pre><span></span><code><span class="n">Authorization</span><span class="o">:</span><span class="w"> </span><span class="n">Bearer</span><span class="w"> </span><span class="n">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9</span><span class="o">.</span><span class="na">eyJpZCI6IjYwZDIxYjQ2NjdkMGQ4OTkyZTYxMGM4NSIsImVtYWlsIjoidXNlckBleGFtcGxlLmNvbSIsInJvbGUiOiJhZG1pbiIsInBlcm1pc3Npb25zIjpbInJlYWQ6ZmFybXMiLCJ3cml0ZTpwaWdzIl0sImlhdCI6MTYyMzc2MDUwMCwiZXhwIjoxNjIzODQ2OTAwfQ</span><span class="o">.</span><span class="mi">8</span><span class="n">yF7MJoo2RL4xMw2Sy2CGF6YHF8L2Q3CMTHfNXfBnLc</span>
</code></pre></div>

<h4 id="token-expiration-and-refresh">Token Expiration and Refresh<a class="headerlink" href="#token-expiration-and-refresh" title="Permanent link">&para;</a></h4>
<p>Tokens have a limited lifespan for security reasons:</p>
<ul>
<li><strong>Access Tokens</strong>: Valid for 24 hours</li>
<li><strong>Refresh Tokens</strong>: Valid for 7 days (when implemented)</li>
</ul>
<p>When a token expires, clients can:</p>
<ol>
<li>Redirect the user to the login page</li>
<li>Use a refresh token to obtain a new access token (when implemented)</li>
<li>Implement silent refresh before token expiration</li>
</ol>
<h4 id="token-refresh-flow">Token Refresh Flow<a class="headerlink" href="#token-refresh-flow" title="Permanent link">&para;</a></h4>
<ol>
<li>Client detects token expiration (or proactively refreshes before expiration)</li>
<li>Client sends refresh token to <code>/api/auth/refresh</code> endpoint</li>
<li>Server validates refresh token</li>
<li>Server issues new access token</li>
<li>Client updates stored access token</li>
</ol>
<h4 id="security-considerations">Security Considerations<a class="headerlink" href="#security-considerations" title="Permanent link">&para;</a></h4>
<p>The authentication system implements several security measures:</p>
<ol>
<li><strong>HTTPS Only</strong>: All authentication requests must use HTTPS</li>
<li><strong>Token Expiration</strong>: Tokens have a limited lifespan</li>
<li><strong>Secure Storage</strong>: Clients should store tokens securely</li>
<li><strong>CSRF Protection</strong>: Implemented for browser-based clients</li>
<li><strong>Rate Limiting</strong>: Login and token endpoints are rate-limited</li>
<li><strong>Token Revocation</strong>: Administrators can revoke tokens</li>
<li><strong>Password Policies</strong>: Strong password requirements are enforced</li>
<li><strong>Brute Force Protection</strong>: Account lockout after multiple failed attempts</li>
</ol>
<h4 id="implementation-details">Implementation Details<a class="headerlink" href="#implementation-details" title="Permanent link">&para;</a></h4>
<p>The authentication system is implemented using the following components:</p>
<ol>
<li><strong>jsonwebtoken</strong>: Library for generating and verifying JWTs</li>
<li><strong>bcrypt</strong>: Library for password hashing</li>
<li><strong>express-rate-limit</strong>: Middleware for rate limiting</li>
<li><strong>helmet</strong>: Middleware for security headers</li>
<li><strong>Custom Middleware</strong>: For token verification and authorization</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="c1">// Example token verification middleware</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">authenticateJWT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">authHeader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">authorization</span><span class="p">;</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">authHeader</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="nx">authHeader</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">&#39;Bearer &#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">401</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span>
<span class="w">      </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">code</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;UNAUTHORIZED&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Authentication required&#39;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">authHeader</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mf">1</span><span class="p">];</span>

<span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">decoded</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">jwt</span><span class="p">.</span><span class="nx">verify</span><span class="p">(</span><span class="nx">token</span><span class="p">,</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">JWT_SECRET</span><span class="p">);</span>
<span class="w">    </span><span class="nx">req</span><span class="p">.</span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">decoded</span><span class="p">;</span>
<span class="w">    </span><span class="nx">next</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;TokenExpiredError&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">401</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span>
<span class="w">        </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nx">code</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;TOKEN_EXPIRED&#39;</span><span class="p">,</span>
<span class="w">          </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Token has expired&#39;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">401</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span>
<span class="w">      </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">code</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;INVALID_TOKEN&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Invalid token&#39;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>

<h3 id="authentication-endpoints">Authentication Endpoints<a class="headerlink" href="#authentication-endpoints" title="Permanent link">&para;</a></h3>
<h4 id="login">Login<a class="headerlink" href="#login" title="Permanent link">&para;</a></h4>
<p>Authenticates a user with email and password credentials and returns a JWT token.</p>
<ul>
<li><strong>URL</strong>: <code>/api/auth/login</code></li>
<li><strong>Method</strong>: <code>POST</code></li>
<li><strong>Auth Required</strong>: No</li>
<li><strong>Rate Limit</strong>: 5 requests per minute per IP address</li>
<li><strong>Content-Type</strong>: <code>application/json</code></li>
</ul>
<h5 id="request-parameters">Request Parameters<a class="headerlink" href="#request-parameters" title="Permanent link">&para;</a></h5>
<p><strong>Request Body</strong>:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>email</code></td>
<td>String</td>
<td>Yes</td>
<td>User's email address</td>
</tr>
<tr>
<td><code>password</code></td>
<td>String</td>
<td>Yes</td>
<td>User's password (min 8 characters)</td>
</tr>
<tr>
<td><code>rememberMe</code></td>
<td>Boolean</td>
<td>No</td>
<td>Whether to extend token expiration (default: false)</td>
</tr>
</tbody>
</table>
<p><strong>Example Request</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user@example.com&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;password&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;password123&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;rememberMe&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>
</code></pre></div>

<h5 id="response-parameters">Response Parameters<a class="headerlink" href="#response-parameters" title="Permanent link">&para;</a></h5>
<p><strong>Success Response (200 OK)</strong>:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>token</code></td>
<td>String</td>
<td>JWT authentication token</td>
</tr>
<tr>
<td><code>refreshToken</code></td>
<td>String</td>
<td>JWT refresh token (only if rememberMe is true)</td>
</tr>
<tr>
<td><code>expiresIn</code></td>
<td>Number</td>
<td>Token expiration time in seconds</td>
</tr>
<tr>
<td><code>user</code></td>
<td>Object</td>
<td>User information</td>
</tr>
<tr>
<td><code>user.id</code></td>
<td>String</td>
<td>User's unique identifier</td>
</tr>
<tr>
<td><code>user.email</code></td>
<td>String</td>
<td>User's email address</td>
</tr>
<tr>
<td><code>user.firstName</code></td>
<td>String</td>
<td>User's first name</td>
</tr>
<tr>
<td><code>user.lastName</code></td>
<td>String</td>
<td>User's last name</td>
</tr>
<tr>
<td><code>user.role</code></td>
<td>String</td>
<td>User's role (admin, manager, farmer, viewer)</td>
</tr>
<tr>
<td><code>user.lastLogin</code></td>
<td>String</td>
<td>ISO 8601 timestamp of last login</td>
</tr>
<tr>
<td><code>user.assignedFarm</code></td>
<td>Object</td>
<td>Farm assigned to the user (if applicable)</td>
</tr>
<tr>
<td><code>user.permissions</code></td>
<td>Array</td>
<td>List of user permissions</td>
</tr>
</tbody>
</table>
<p><strong>Example Success Response</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjYwZDIxYjQ2NjdkMGQ4OTkyZTYxMGM4NSIsImVtYWlsIjoidXNlckBleGFtcGxlLmNvbSIsInJvbGUiOiJhZG1pbiIsInBlcm1pc3Npb25zIjpbInJlYWQ6ZmFybXMiLCJ3cml0ZTpwaWdzIl0sImlhdCI6MTYyMzc2MDUwMCwiZXhwIjoxNjIzODQ2OTAwfQ.8yF7MJoo2RL4xMw2Sy2CGF6YHF8L2Q3CMTHfNXfBnLc&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;refreshToken&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjYwZDIxYjQ2NjdkMGQ4OTkyZTYxMGM4NSIsInR5cGUiOiJyZWZyZXNoIiwiaWF0IjoxNjIzNzYwNTAwLCJleHAiOjE2MjQzNjUzMDB9.7UKIzA3sLVRaJaT_FIM9w7G_ZxH9bS1JV2cv7dxsQxE&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;expiresIn&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">86400</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;user&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c85&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user@example.com&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;firstName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;John&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;lastName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Doe&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;role&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;admin&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;lastLogin&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2023-06-15T10:30:45.123Z&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;assignedFarm&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c87&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Farm 1&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;permissions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="s2">&quot;read:farms&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;write:farms&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;read:barns&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;write:barns&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;read:stalls&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;write:stalls&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;read:pigs&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;write:pigs&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;read:users&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;write:users&quot;</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h5 id="error-responses">Error Responses<a class="headerlink" href="#error-responses" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th>Status Code</th>
<th>Error Code</th>
<th>Description</th>
<th>Possible Cause</th>
</tr>
</thead>
<tbody>
<tr>
<td>400</td>
<td><code>MISSING_CREDENTIALS</code></td>
<td>Missing email or password</td>
<td>Required fields not provided</td>
</tr>
<tr>
<td>400</td>
<td><code>INVALID_EMAIL_FORMAT</code></td>
<td>Invalid email format</td>
<td>Email doesn't match expected format</td>
</tr>
<tr>
<td>401</td>
<td><code>INVALID_CREDENTIALS</code></td>
<td>Invalid credentials</td>
<td>Email or password is incorrect</td>
</tr>
<tr>
<td>403</td>
<td><code>ACCOUNT_INACTIVE</code></td>
<td>Account is inactive</td>
<td>User account has been deactivated</td>
</tr>
<tr>
<td>403</td>
<td><code>ACCOUNT_LOCKED</code></td>
<td>Account is locked</td>
<td>Too many failed login attempts</td>
</tr>
<tr>
<td>429</td>
<td><code>RATE_LIMIT_EXCEEDED</code></td>
<td>Too many requests</td>
<td>Rate limit exceeded</td>
</tr>
</tbody>
</table>
<p><strong>Example Error Response (401 Unauthorized)</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;error&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;code&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;INVALID_CREDENTIALS&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Invalid email or password&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;details&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;remainingAttempts&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h5 id="implementation-notes">Implementation Notes<a class="headerlink" href="#implementation-notes" title="Permanent link">&para;</a></h5>
<ol>
<li><strong>Password Validation</strong>:</li>
<li>Passwords are hashed using bcrypt before comparison</li>
<li>
<p>Failed login attempts are tracked and limited</p>
</li>
<li>
<p><strong>Token Generation</strong>:</p>
</li>
<li>Tokens include user ID, role, and permissions</li>
<li>Standard tokens expire in 24 hours</li>
<li>
<p>"Remember me" tokens expire in 7 days</p>
</li>
<li>
<p><strong>Security Measures</strong>:</p>
</li>
<li>Login attempts are rate-limited to prevent brute force attacks</li>
<li>Account is temporarily locked after 5 failed attempts</li>
<li>All login attempts are logged for security auditing</li>
</ol>
<h5 id="code-example">Code Example<a class="headerlink" href="#code-example" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="c1">// routes/auth.js</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">loginLimiter</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">email</span><span class="p">,</span><span class="w"> </span><span class="nx">password</span><span class="p">,</span><span class="w"> </span><span class="nx">rememberMe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Validate input</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">email</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="nx">password</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">400</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span>
<span class="w">        </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nx">code</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;MISSING_CREDENTIALS&#39;</span><span class="p">,</span>
<span class="w">          </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Email and password are required&#39;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Validate email format</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">emailRegex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sr">/^[^\s@]+@[^\s@]+\.[^\s@]+$/</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">emailRegex</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">email</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">400</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span>
<span class="w">        </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nx">code</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;INVALID_EMAIL_FORMAT&#39;</span><span class="p">,</span>
<span class="w">          </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Invalid email format&#39;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Find user</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">User</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span><span class="w"> </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="nx">email</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">user</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// Log failed attempt</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">LoginAttempt</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
<span class="w">        </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="nx">email</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">(),</span>
<span class="w">        </span><span class="nx">ipAddress</span><span class="o">:</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">ip</span><span class="p">,</span>
<span class="w">        </span><span class="nx">successful</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">timestamp</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">()</span>
<span class="w">      </span><span class="p">});</span>

<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">401</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span>
<span class="w">        </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nx">code</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;INVALID_CREDENTIALS&#39;</span><span class="p">,</span>
<span class="w">          </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Invalid email or password&#39;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Check if account is locked</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">recentFailedAttempts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">LoginAttempt</span><span class="p">.</span><span class="nx">countDocuments</span><span class="p">({</span>
<span class="w">      </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="nx">email</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">(),</span>
<span class="w">      </span><span class="nx">successful</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">      </span><span class="nx">timestamp</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$gt</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">15</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">60</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1000</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// Last 15 minutes</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">recentFailedAttempts</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">403</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span>
<span class="w">        </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nx">code</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;ACCOUNT_LOCKED&#39;</span><span class="p">,</span>
<span class="w">          </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Account is locked due to too many failed attempts&#39;</span><span class="p">,</span>
<span class="w">          </span><span class="nx">details</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">unlockTime</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">15</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">60</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1000</span><span class="p">)</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Check if user is active</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">user</span><span class="p">.</span><span class="nx">isActive</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">403</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span>
<span class="w">        </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nx">code</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;ACCOUNT_INACTIVE&#39;</span><span class="p">,</span>
<span class="w">          </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Account is inactive&#39;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Check password</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">isMatch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">comparePassword</span><span class="p">(</span><span class="nx">password</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">isMatch</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// Log failed attempt</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">LoginAttempt</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
<span class="w">        </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="nx">email</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">(),</span>
<span class="w">        </span><span class="nx">ipAddress</span><span class="o">:</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">ip</span><span class="p">,</span>
<span class="w">        </span><span class="nx">successful</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">timestamp</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(),</span>
<span class="w">        </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">_id</span>
<span class="w">      </span><span class="p">});</span>

<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">401</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span>
<span class="w">        </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nx">code</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;INVALID_CREDENTIALS&#39;</span><span class="p">,</span>
<span class="w">          </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Invalid email or password&#39;</span><span class="p">,</span>
<span class="w">          </span><span class="nx">details</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">remainingAttempts</span><span class="o">:</span><span class="w"> </span><span class="mf">5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">recentFailedAttempts</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Get user permissions</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">permissions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getUserPermissions</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Generate JWT token</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">tokenExpiration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rememberMe</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;7d&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;1d&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">expiresIn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rememberMe</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mf">7</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">24</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">60</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">60</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">24</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">60</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">60</span><span class="p">;</span><span class="w"> </span><span class="c1">// in seconds</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">jwt</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">_id</span><span class="p">,</span>
<span class="w">        </span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">role</span><span class="p">,</span>
<span class="w">        </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>
<span class="w">        </span><span class="nx">permissions</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">JWT_SECRET</span><span class="p">,</span>
<span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="nx">expiresIn</span><span class="o">:</span><span class="w"> </span><span class="nx">tokenExpiration</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Generate refresh token if rememberMe is true</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">refreshToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">rememberMe</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">refreshToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">jwt</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">_id</span><span class="p">,</span>
<span class="w">          </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;refresh&#39;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">JWT_REFRESH_SECRET</span><span class="p">,</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nx">expiresIn</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;7d&#39;</span><span class="w"> </span><span class="p">}</span>
<span class="w">      </span><span class="p">);</span>

<span class="w">      </span><span class="c1">// Store refresh token hash in database</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">refreshTokenHash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">bcrypt</span><span class="p">.</span><span class="nx">hash</span><span class="p">(</span><span class="nx">refreshToken</span><span class="p">,</span><span class="w"> </span><span class="mf">10</span><span class="p">);</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">RefreshToken</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
<span class="w">        </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">_id</span><span class="p">,</span>
<span class="w">        </span><span class="nx">token</span><span class="o">:</span><span class="w"> </span><span class="nx">refreshTokenHash</span><span class="p">,</span>
<span class="w">        </span><span class="nx">expiresAt</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">7</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">24</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">60</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">60</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1000</span><span class="p">)</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Update last login</span>
<span class="w">    </span><span class="nx">user</span><span class="p">.</span><span class="nx">lastLogin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">();</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Log successful login</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">LoginAttempt</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
<span class="w">      </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="nx">email</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">(),</span>
<span class="w">      </span><span class="nx">ipAddress</span><span class="o">:</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">ip</span><span class="p">,</span>
<span class="w">      </span><span class="nx">successful</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">      </span><span class="nx">timestamp</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(),</span>
<span class="w">      </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">_id</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// Prepare user response (exclude sensitive data)</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">userResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">_id</span><span class="p">,</span>
<span class="w">      </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>
<span class="w">      </span><span class="nx">firstName</span><span class="o">:</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">firstName</span><span class="p">,</span>
<span class="w">      </span><span class="nx">lastName</span><span class="o">:</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">lastName</span><span class="p">,</span>
<span class="w">      </span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">role</span><span class="p">,</span>
<span class="w">      </span><span class="nx">lastLogin</span><span class="o">:</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">lastLogin</span><span class="p">,</span>
<span class="w">      </span><span class="nx">permissions</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="c1">// Include assigned farm if exists</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">assignedFarm</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">farm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">Farm</span><span class="p">.</span><span class="nx">findById</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">assignedFarm</span><span class="p">);</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">farm</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">userResponse</span><span class="p">.</span><span class="nx">assignedFarm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="nx">farm</span><span class="p">.</span><span class="nx">_id</span><span class="p">,</span>
<span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="nx">farm</span><span class="p">.</span><span class="nx">name</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Return response</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">token</span><span class="p">,</span>
<span class="w">      </span><span class="nx">expiresIn</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">refreshToken</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">response</span><span class="p">.</span><span class="nx">refreshToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">refreshToken</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">response</span><span class="p">.</span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">userResponse</span><span class="p">;</span>

<span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Login error:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
<span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">500</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span>
<span class="w">      </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">code</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;SERVER_ERROR&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;An unexpected error occurred&#39;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">});</span>
</code></pre></div>

<h4 id="verify-token">Verify Token<a class="headerlink" href="#verify-token" title="Permanent link">&para;</a></h4>
<p>Verifies a token and returns the associated user information.</p>
<ul>
<li><strong>URL</strong>: <code>/api/auth/token</code></li>
<li><strong>Method</strong>: <code>GET</code></li>
<li><strong>Auth Required</strong>: Yes</li>
</ul>
<p><strong>Success Response (200 OK)</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;user&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c85&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user@example.com&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;firstName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;John&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;lastName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Doe&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;role&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;admin&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;assignedFarm&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c86&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Farm 1&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...&quot;</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Error Responses</strong>:
- <code>401 Unauthorized</code>: Invalid or expired token
- <code>404 Not Found</code>: User not found</p>
<h2 id="user-management-api">User Management API<a class="headerlink" href="#user-management-api" title="Permanent link">&para;</a></h2>
<h3 id="get-all-users">Get All Users<a class="headerlink" href="#get-all-users" title="Permanent link">&para;</a></h3>
<p>Retrieves a list of all users (admin only).</p>
<ul>
<li><strong>URL</strong>: <code>/api/users</code></li>
<li><strong>Method</strong>: <code>GET</code></li>
<li><strong>Auth Required</strong>: Yes (Admin)</li>
</ul>
<p><strong>Query Parameters</strong>:
- <code>limit</code> (optional): Maximum number of users to return (default: 100)
- <code>page</code> (optional): Page number for pagination (default: 1)
- <code>sort</code> (optional): Field to sort by (default: "lastName")
- <code>order</code> (optional): Sort order, "asc" or "desc" (default: "asc")
- <code>search</code> (optional): Search term for filtering users</p>
<p><strong>Success Response (200 OK)</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">[</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c85&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;admin@example.com&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;firstName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Admin&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;lastName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;User&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;role&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;admin&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;isActive&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;lastLogin&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2023-06-15T10:30:45.123Z&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c86&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;farmer@example.com&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;firstName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Farmer&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;lastName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;User&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;role&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;farmer&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;isActive&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;lastLogin&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2023-06-14T08:15:30.456Z&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;assignedFarm&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c87&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">]</span>
</code></pre></div>

<p><strong>Error Responses</strong>:
- <code>401 Unauthorized</code>: Not authenticated
- <code>403 Forbidden</code>: Not authorized as admin
- <code>500 Internal Server Error</code>: Server error</p>
<h3 id="get-user-by-id">Get User by ID<a class="headerlink" href="#get-user-by-id" title="Permanent link">&para;</a></h3>
<p>Retrieves a specific user by ID.</p>
<ul>
<li><strong>URL</strong>: <code>/api/users/:id</code></li>
<li><strong>Method</strong>: <code>GET</code></li>
<li><strong>Auth Required</strong>: Yes (Admin or self)</li>
</ul>
<p><strong>Success Response (200 OK)</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c85&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user@example.com&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;firstName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;John&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;lastName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Doe&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;role&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;farmer&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;isActive&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;lastLogin&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2023-06-15T10:30:45.123Z&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;assignedFarm&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c87&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Farm 1&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;permissions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;read:farms&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;write:pigs&quot;</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Error Responses</strong>:
- <code>401 Unauthorized</code>: Not authenticated
- <code>403 Forbidden</code>: Not authorized to view this user
- <code>404 Not Found</code>: User not found
- <code>500 Internal Server Error</code>: Server error</p>
<h3 id="create-user">Create User<a class="headerlink" href="#create-user" title="Permanent link">&para;</a></h3>
<p>Creates a new user (admin only).</p>
<ul>
<li><strong>URL</strong>: <code>/api/auth/register</code></li>
<li><strong>Method</strong>: <code>POST</code></li>
<li><strong>Auth Required</strong>: Yes (Admin)</li>
</ul>
<p><strong>Request Body</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;newuser@example.com&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;password&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;password123&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;firstName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;New&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;lastName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;User&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;role&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;farmer&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;permissions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;read:farms&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;write:pigs&quot;</span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;assignedFarm&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c87&quot;</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Success Response (201 Created)</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c88&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;newuser@example.com&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;firstName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;New&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;lastName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;User&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;role&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;farmer&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;isActive&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;permissions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;read:farms&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;write:pigs&quot;</span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;assignedFarm&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c87&quot;</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Error Responses</strong>:
- <code>400 Bad Request</code>: Invalid input or user already exists
- <code>401 Unauthorized</code>: Not authenticated
- <code>403 Forbidden</code>: Not authorized as admin
- <code>500 Internal Server Error</code>: Server error</p>
<h3 id="update-user">Update User<a class="headerlink" href="#update-user" title="Permanent link">&para;</a></h3>
<p>Updates an existing user.</p>
<ul>
<li><strong>URL</strong>: <code>/api/users/:id</code></li>
<li><strong>Method</strong>: <code>PUT</code></li>
<li><strong>Auth Required</strong>: Yes (Admin or self)</li>
</ul>
<p><strong>Request Body</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;firstName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Updated&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;lastName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Name&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;role&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;farmer&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;isActive&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;assignedFarm&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c87&quot;</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Success Response (200 OK)</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c85&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user@example.com&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;firstName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Updated&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;lastName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Name&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;role&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;farmer&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;isActive&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;lastLogin&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2023-06-15T10:30:45.123Z&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;assignedFarm&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c87&quot;</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Error Responses</strong>:
- <code>400 Bad Request</code>: Invalid input
- <code>401 Unauthorized</code>: Not authenticated
- <code>403 Forbidden</code>: Not authorized to update this user
- <code>404 Not Found</code>: User not found
- <code>500 Internal Server Error</code>: Server error</p>
<h3 id="delete-user">Delete User<a class="headerlink" href="#delete-user" title="Permanent link">&para;</a></h3>
<p>Deletes a user (admin only).</p>
<ul>
<li><strong>URL</strong>: <code>/api/users/:id</code></li>
<li><strong>Method</strong>: <code>DELETE</code></li>
<li><strong>Auth Required</strong>: Yes (Admin)</li>
</ul>
<p><strong>Success Response (200 OK)</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;User deleted successfully&quot;</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Error Responses</strong>:
- <code>401 Unauthorized</code>: Not authenticated
- <code>403 Forbidden</code>: Not authorized as admin
- <code>404 Not Found</code>: User not found
- <code>500 Internal Server Error</code>: Server error</p>
<h2 id="farm-management-api">Farm Management API<a class="headerlink" href="#farm-management-api" title="Permanent link">&para;</a></h2>
<h3 id="get-all-farms">Get All Farms<a class="headerlink" href="#get-all-farms" title="Permanent link">&para;</a></h3>
<p>Retrieves a list of all farms.</p>
<ul>
<li><strong>URL</strong>: <code>/api/farms</code></li>
<li><strong>Method</strong>: <code>GET</code></li>
<li><strong>Auth Required</strong>: Yes</li>
</ul>
<p><strong>Success Response (200 OK)</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">[</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c87&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Farm 1&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;location&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Location 1&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Description for Farm 1&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;isActive&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;counts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;barns&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;stalls&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;pigs&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c88&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Farm 2&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;location&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Location 2&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Description for Farm 2&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;isActive&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;counts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;barns&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;stalls&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;pigs&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">60</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">]</span>
</code></pre></div>

<p><strong>Error Responses</strong>:
- <code>401 Unauthorized</code>: Not authenticated
- <code>500 Internal Server Error</code>: Server error</p>
<h3 id="get-farm-by-id">Get Farm by ID<a class="headerlink" href="#get-farm-by-id" title="Permanent link">&para;</a></h3>
<p>Retrieves a specific farm by ID.</p>
<ul>
<li><strong>URL</strong>: <code>/api/farms/:id</code></li>
<li><strong>Method</strong>: <code>GET</code></li>
<li><strong>Auth Required</strong>: Yes</li>
</ul>
<p><strong>Success Response (200 OK)</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c87&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Farm 1&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;location&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Location 1&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Description for Farm 1&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;isActive&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;counts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;barns&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;stalls&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;pigs&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;devices&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;healthStatus&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;healthy&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">80</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;atRisk&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;critical&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;barns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c89&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Barn A&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;farmId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c87&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;stallCount&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c90&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Barn B&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;farmId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c87&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;stallCount&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;recentPigs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;pigId&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1001</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;tag&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PIG-1001&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;breed&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Yorkshire&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;age&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;devices&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c91&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;deviceId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;DEV-001&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;temperature&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;active&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Error Responses</strong>:
- <code>401 Unauthorized</code>: Not authenticated
- <code>403 Forbidden</code>: Not authorized to access this farm
- <code>404 Not Found</code>: Farm not found
- <code>500 Internal Server Error</code>: Server error</p>
<h3 id="create-farm">Create Farm<a class="headerlink" href="#create-farm" title="Permanent link">&para;</a></h3>
<p>Creates a new farm (admin only).</p>
<ul>
<li><strong>URL</strong>: <code>/api/farms</code></li>
<li><strong>Method</strong>: <code>POST</code></li>
<li><strong>Auth Required</strong>: Yes (Admin)</li>
</ul>
<p><strong>Request Body</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;New Farm&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;location&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;New Location&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Description for New Farm&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;isActive&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Success Response (201 Created)</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c92&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;New Farm&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;location&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;New Location&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Description for New Farm&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;isActive&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Error Responses</strong>:
- <code>400 Bad Request</code>: Invalid input
- <code>401 Unauthorized</code>: Not authenticated
- <code>403 Forbidden</code>: Not authorized as admin
- <code>500 Internal Server Error</code>: Server error</p>
<h3 id="update-farm">Update Farm<a class="headerlink" href="#update-farm" title="Permanent link">&para;</a></h3>
<p>Updates an existing farm (admin only).</p>
<ul>
<li><strong>URL</strong>: <code>/api/farms/:id</code></li>
<li><strong>Method</strong>: <code>PUT</code></li>
<li><strong>Auth Required</strong>: Yes (Admin)</li>
</ul>
<p><strong>Request Body</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Updated Farm&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;location&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Updated Location&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Updated description&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;isActive&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Success Response (200 OK)</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c87&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Updated Farm&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;location&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Updated Location&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Updated description&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;isActive&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Error Responses</strong>:
- <code>400 Bad Request</code>: Invalid input
- <code>401 Unauthorized</code>: Not authenticated
- <code>403 Forbidden</code>: Not authorized as admin
- <code>404 Not Found</code>: Farm not found
- <code>500 Internal Server Error</code>: Server error</p>
<h3 id="delete-farm">Delete Farm<a class="headerlink" href="#delete-farm" title="Permanent link">&para;</a></h3>
<p>Deletes a farm (admin only).</p>
<ul>
<li><strong>URL</strong>: <code>/api/farms/:id</code></li>
<li><strong>Method</strong>: <code>DELETE</code></li>
<li><strong>Auth Required</strong>: Yes (Admin)</li>
</ul>
<p><strong>Query Parameters</strong>:
- <code>cascade</code> (optional): If "true", deletes all associated barns, stalls, and pigs</p>
<p><strong>Success Response (200 OK)</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Farm deleted successfully&quot;</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Error Responses</strong>:
- <code>401 Unauthorized</code>: Not authenticated
- <code>403 Forbidden</code>: Not authorized as admin
- <code>404 Not Found</code>: Farm not found
- <code>500 Internal Server Error</code>: Server error</p>
<h2 id="pig-management-api">Pig Management API<a class="headerlink" href="#pig-management-api" title="Permanent link">&para;</a></h2>
<h3 id="get-all-pigs">Get All Pigs<a class="headerlink" href="#get-all-pigs" title="Permanent link">&para;</a></h3>
<p>Retrieves a list of all pigs.</p>
<ul>
<li><strong>URL</strong>: <code>/api/pigs</code></li>
<li><strong>Method</strong>: <code>GET</code></li>
<li><strong>Auth Required</strong>: Yes</li>
</ul>
<p><strong>Success Response (200 OK)</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">[</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PIG-001&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;healthy&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;costs&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;12&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;region&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Stall A&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;stability&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.8</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;lastEdited&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;01/01/2023, 12:00&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;breed&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Yorkshire&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;active&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PIG-002&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;at risk&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;costs&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;8&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;region&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Stall B&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;stability&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.4</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;lastEdited&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;02/01/2023, 14:30&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;breed&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Duroc&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;active&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">]</span>
</code></pre></div>

<p><strong>Error Responses</strong>:
- <code>401 Unauthorized</code>: Not authenticated
- <code>500 Internal Server Error</code>: Server error</p>
<h3 id="get-pig-overview">Get Pig Overview<a class="headerlink" href="#get-pig-overview" title="Permanent link">&para;</a></h3>
<p>Retrieves aggregated pig data for the dashboard.</p>
<ul>
<li><strong>URL</strong>: <code>/api/pigs/overview</code></li>
<li><strong>Method</strong>: <code>GET</code></li>
<li><strong>Auth Required</strong>: Yes</li>
</ul>
<p><strong>Query Parameters</strong>:
- <code>filter</code> (optional): Filter by category (e.g., "breeding", "new", "healthy")</p>
<p><strong>Success Response (200 OK)</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;success&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Breeding&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;Farm 1&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;Farm 2&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;averageWeight&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">120</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Healthy&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;Farm 1&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">80</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;Farm 2&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">40</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;averageWeight&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;At Risk&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;Farm 1&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;Farm 2&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;averageWeight&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">90</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;stats&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;totalPigs&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">160</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;categories&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Breeding&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Healthy&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;At Risk&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;locations&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Farm 1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Farm 2&quot;</span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Error Responses</strong>:
- <code>401 Unauthorized</code>: Not authenticated
- <code>500 Internal Server Error</code>: Server error</p>
<h3 id="get-pig-by-id">Get Pig by ID<a class="headerlink" href="#get-pig-by-id" title="Permanent link">&para;</a></h3>
<p>Retrieves a specific pig by ID.</p>
<ul>
<li><strong>URL</strong>: <code>/api/pigs/:id</code></li>
<li><strong>Method</strong>: <code>GET</code></li>
<li><strong>Auth Required</strong>: Yes</li>
</ul>
<p><strong>Success Response (200 OK)</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;pigId&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1001</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;tag&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PIG-1001&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;breed&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Yorkshire&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;age&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;currentLocation&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;farmId&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c87&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Farm 1&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;barnId&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c89&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Barn A&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;stallId&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c93&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Stall 1&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;active&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Error Responses</strong>:
- <code>400 Bad Request</code>: Invalid pig ID
- <code>401 Unauthorized</code>: Not authenticated
- <code>404 Not Found</code>: Pig not found
- <code>500 Internal Server Error</code>: Server error</p>
<h3 id="get-pig-posture-data">Get Pig Posture Data<a class="headerlink" href="#get-pig-posture-data" title="Permanent link">&para;</a></h3>
<p>Retrieves posture data for a specific pig.</p>
<ul>
<li><strong>URL</strong>: <code>/api/pigs/:id/posture/aggregated</code></li>
<li><strong>Method</strong>: <code>GET</code></li>
<li><strong>Auth Required</strong>: Yes</li>
</ul>
<p><strong>Query Parameters</strong>:
- <code>start</code> (optional): Start date (YYYY-MM-DD)
- <code>end</code> (optional): End date (YYYY-MM-DD)</p>
<p><strong>Success Response (200 OK)</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">[</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;date&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2022-08-01&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;standing&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">45</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;sitting&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;lying&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;date&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2022-08-02&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;standing&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">40</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;sitting&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">35</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;lying&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;date&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2022-08-03&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;standing&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;sitting&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;lying&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">]</span>
</code></pre></div>

<p><strong>Error Responses</strong>:
- <code>400 Bad Request</code>: Invalid pig ID or date range
- <code>401 Unauthorized</code>: Not authenticated
- <code>404 Not Found</code>: Pig not found
- <code>500 Internal Server Error</code>: Server error</p>
<h3 id="create-pig">Create Pig<a class="headerlink" href="#create-pig" title="Permanent link">&para;</a></h3>
<p>Creates a new pig.</p>
<ul>
<li><strong>URL</strong>: <code>/api/pigs</code></li>
<li><strong>Method</strong>: <code>POST</code></li>
<li><strong>Auth Required</strong>: Yes</li>
</ul>
<p><strong>Request Body</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;pigId&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1003</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;tag&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PIG-1003&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;breed&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Yorkshire&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;age&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;currentLocation&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;farmId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c87&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;barnId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c89&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;stallId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c93&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Success Response (201 Created)</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;success&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;pig&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;pigId&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1003</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;tag&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PIG-1003&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;breed&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Yorkshire&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;age&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;currentLocation&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;farmId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c87&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;barnId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c89&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;stallId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c93&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;active&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c94&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Error Responses</strong>:
- <code>400 Bad Request</code>: Invalid input or pig ID already exists
- <code>401 Unauthorized</code>: Not authenticated
- <code>500 Internal Server Error</code>: Server error</p>
<h2 id="statistics-api">Statistics API<a class="headerlink" href="#statistics-api" title="Permanent link">&para;</a></h2>
<h3 id="get-system-statistics">Get System Statistics<a class="headerlink" href="#get-system-statistics" title="Permanent link">&para;</a></h3>
<p>Retrieves system-wide statistics.</p>
<ul>
<li><strong>URL</strong>: <code>/api/stats</code></li>
<li><strong>Method</strong>: <code>GET</code></li>
<li><strong>Auth Required</strong>: Yes</li>
</ul>
<p><strong>Success Response (200 OK)</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;counts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;pigs&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">160</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;farms&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;barns&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;stalls&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;devices&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;healthStatus&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;healthy&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">120</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;at risk&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;critical&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;no movement&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;recentActivity&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c95&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;pig&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;created&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Pig PIG-1003 was added to the system&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2023-06-15T14:30:45.123Z&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;userId&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;firstName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;John&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;lastName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Doe&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;john@example.com&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Error Responses</strong>:
- <code>401 Unauthorized</code>: Not authenticated
- <code>500 Internal Server Error</code>: Server error</p>
<h2 id="activity-logging-api">Activity Logging API<a class="headerlink" href="#activity-logging-api" title="Permanent link">&para;</a></h2>
<h3 id="get-recent-activities">Get Recent Activities<a class="headerlink" href="#get-recent-activities" title="Permanent link">&para;</a></h3>
<p>Retrieves recent system activities.</p>
<ul>
<li><strong>URL</strong>: <code>/api/activities</code></li>
<li><strong>Method</strong>: <code>GET</code></li>
<li><strong>Auth Required</strong>: Yes</li>
</ul>
<p><strong>Query Parameters</strong>:
- <code>limit</code> (optional): Maximum number of activities to return (default: 10)
- <code>type</code> (optional): Filter by activity type (e.g., "user", "pig", "farm")
- <code>userId</code> (optional): Filter by user ID</p>
<p><strong>Success Response (200 OK)</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">[</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c95&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;pig&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;created&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Pig PIG-1003 was added to the system&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2023-06-15T14:30:45.123Z&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;userId&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c85&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;firstName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;John&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;lastName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Doe&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;john@example.com&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;entityId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c94&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;pigId&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1003</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;tag&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PIG-1003&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c96&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;login&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;User \&quot;john@example.com\&quot; logged in&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2023-06-15T10:30:45.123Z&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;userId&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c85&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;firstName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;John&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;lastName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Doe&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;john@example.com&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;john@example.com&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;role&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;admin&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">]</span>
</code></pre></div>

<p><strong>Error Responses</strong>:
- <code>401 Unauthorized</code>: Not authenticated
- <code>500 Internal Server Error</code>: Server error</p>
<h2 id="data-upload-api">Data Upload API<a class="headerlink" href="#data-upload-api" title="Permanent link">&para;</a></h2>
<h3 id="upload-posture-data">Upload Posture Data<a class="headerlink" href="#upload-posture-data" title="Permanent link">&para;</a></h3>
<p>Uploads posture data for a pig.</p>
<ul>
<li><strong>URL</strong>: <code>/api/upload/postureupload</code></li>
<li><strong>Method</strong>: <code>POST</code></li>
<li><strong>Auth Required</strong>: Yes</li>
</ul>
<p><strong>Request Body</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;pigId&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1001</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2023-06-15T12:00:00.000Z&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Success Response (201 Created)</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;success&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;pigId&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1001</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2023-06-15T12:00:00.000Z&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60d21b4667d0d8992e610c97&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Error Responses</strong>:
- <code>400 Bad Request</code>: Invalid input
- <code>401 Unauthorized</code>: Not authenticated
- <code>404 Not Found</code>: Pig not found
- <code>500 Internal Server Error</code>: Server error</p>
<h2 id="real-time-communication">Real-time Communication<a class="headerlink" href="#real-time-communication" title="Permanent link">&para;</a></h2>
<p>In addition to the RESTful API, the system provides real-time updates via Socket.IO.</p>
<h3 id="socketio-events">Socket.IO Events<a class="headerlink" href="#socketio-events" title="Permanent link">&para;</a></h3>
<h4 id="connection">Connection<a class="headerlink" href="#connection" title="Permanent link">&para;</a></h4>
<p>Clients connect to the Socket.IO server:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Client-side code</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">io</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;socket.io-client&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">io</span><span class="p">(</span><span class="s1">&#39;http://localhost:8080&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;/socket.io&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">transports</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;websocket&#39;</span><span class="p">]</span>
<span class="p">});</span>

<span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connect&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Connected to Socket.IO server&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Join rooms based on user role</span>
<span class="w">  </span><span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;join&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;user-id&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;admin&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">assignedFarm</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;farm-id&#39;</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div>

<h4 id="stats-update">Stats Update<a class="headerlink" href="#stats-update" title="Permanent link">&para;</a></h4>
<p>Clients receive updated statistics:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Client-side code</span>
<span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;stats_update&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">stats</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Received updated stats:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">stats</span><span class="p">);</span>
<span class="w">  </span><span class="c1">// Update UI with new stats</span>
<span class="p">});</span>
</code></pre></div>

<h4 id="activity-update">Activity Update<a class="headerlink" href="#activity-update" title="Permanent link">&para;</a></h4>
<p>Clients receive new activity logs:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Client-side code</span>
<span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;activity&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">activity</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;New activity:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">activity</span><span class="p">);</span>
<span class="w">  </span><span class="c1">// Update activity feed in UI</span>
<span class="p">});</span>
</code></pre></div>

<h2 id="rate-limiting">Rate Limiting<a class="headerlink" href="#rate-limiting" title="Permanent link">&para;</a></h2>
<p>To protect the API from abuse, rate limiting is implemented on certain endpoints:</p>
<ul>
<li><code>/api/auth/login</code>: 5 requests per minute per IP</li>
<li>Most other endpoints: 100 requests per 15 minutes per IP</li>
</ul>
<p>When a rate limit is exceeded, the API returns a <code>429 Too Many Requests</code> response with information about when the limit will reset.</p>
<h2 id="error-handling">Error Handling<a class="headerlink" href="#error-handling" title="Permanent link">&para;</a></h2>
<p>The PAAL API implements a comprehensive and consistent error handling strategy to provide clear, actionable feedback to clients. This section details the error response format, error categorization, and implementation details.</p>
<h3 id="error-response-format">Error Response Format<a class="headerlink" href="#error-response-format" title="Permanent link">&para;</a></h3>
<p>All API error responses follow a consistent structure:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;error&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;code&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ERROR_CODE&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Human-readable error message&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;details&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// Additional context-specific error details</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/api/resource/123&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2023-06-15T10:30:45.123Z&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;requestId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;req-123456&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="error-response-fields">Error Response Fields<a class="headerlink" href="#error-response-fields" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Always Present</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>error.code</code></td>
<td>String</td>
<td>Machine-readable error code</td>
<td>Yes</td>
</tr>
<tr>
<td><code>error.message</code></td>
<td>String</td>
<td>Human-readable error description</td>
<td>Yes</td>
</tr>
<tr>
<td><code>error.details</code></td>
<td>Object</td>
<td>Additional error context</td>
<td>No</td>
</tr>
<tr>
<td><code>error.path</code></td>
<td>String</td>
<td>API endpoint path that generated the error</td>
<td>Yes</td>
</tr>
<tr>
<td><code>error.timestamp</code></td>
<td>String</td>
<td>ISO 8601 timestamp when the error occurred</td>
<td>Yes</td>
</tr>
<tr>
<td><code>error.requestId</code></td>
<td>String</td>
<td>Unique identifier for the request (for support/debugging)</td>
<td>Yes</td>
</tr>
</tbody>
</table>
<h3 id="http-status-codes">HTTP Status Codes<a class="headerlink" href="#http-status-codes" title="Permanent link">&para;</a></h3>
<p>The API uses appropriate HTTP status codes to indicate the nature of errors:</p>
<table>
<thead>
<tr>
<th>Status Code</th>
<th>Category</th>
<th>Description</th>
<th>Example Scenarios</th>
</tr>
</thead>
<tbody>
<tr>
<td>400</td>
<td>Bad Request</td>
<td>The request contains invalid parameters or is malformed</td>
<td>Missing required fields, invalid data format</td>
</tr>
<tr>
<td>401</td>
<td>Unauthorized</td>
<td>Authentication is required or has failed</td>
<td>Missing token, expired token, invalid credentials</td>
</tr>
<tr>
<td>403</td>
<td>Forbidden</td>
<td>The authenticated user lacks permission</td>
<td>Attempting to access restricted resources</td>
</tr>
<tr>
<td>404</td>
<td>Not Found</td>
<td>The requested resource does not exist</td>
<td>Invalid ID, deleted resource</td>
</tr>
<tr>
<td>409</td>
<td>Conflict</td>
<td>The request conflicts with the current state</td>
<td>Duplicate entry, concurrent modification</td>
</tr>
<tr>
<td>422</td>
<td>Unprocessable Entity</td>
<td>The request is well-formed but contains semantic errors</td>
<td>Validation errors</td>
</tr>
<tr>
<td>429</td>
<td>Too Many Requests</td>
<td>The client has sent too many requests</td>
<td>Rate limit exceeded</td>
</tr>
<tr>
<td>500</td>
<td>Internal Server Error</td>
<td>An unexpected error occurred on the server</td>
<td>Database errors, unhandled exceptions</td>
</tr>
<tr>
<td>503</td>
<td>Service Unavailable</td>
<td>The service is temporarily unavailable</td>
<td>Maintenance, overload</td>
</tr>
</tbody>
</table>
<h3 id="error-codes">Error Codes<a class="headerlink" href="#error-codes" title="Permanent link">&para;</a></h3>
<p>The API uses standardized error codes to provide machine-readable error information:</p>
<h4 id="authentication-errors">Authentication Errors<a class="headerlink" href="#authentication-errors" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Error Code</th>
<th>HTTP Status</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>UNAUTHORIZED</code></td>
<td>401</td>
<td>Authentication is required</td>
</tr>
<tr>
<td><code>INVALID_CREDENTIALS</code></td>
<td>401</td>
<td>Invalid username or password</td>
</tr>
<tr>
<td><code>INVALID_TOKEN</code></td>
<td>401</td>
<td>The provided token is invalid</td>
</tr>
<tr>
<td><code>TOKEN_EXPIRED</code></td>
<td>401</td>
<td>The provided token has expired</td>
</tr>
<tr>
<td><code>ACCOUNT_INACTIVE</code></td>
<td>403</td>
<td>The user account is inactive</td>
</tr>
<tr>
<td><code>ACCOUNT_LOCKED</code></td>
<td>403</td>
<td>The account is temporarily locked</td>
</tr>
<tr>
<td><code>INSUFFICIENT_PERMISSIONS</code></td>
<td>403</td>
<td>The user lacks required permissions</td>
</tr>
</tbody>
</table>
<h4 id="validation-errors">Validation Errors<a class="headerlink" href="#validation-errors" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Error Code</th>
<th>HTTP Status</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>VALIDATION_ERROR</code></td>
<td>422</td>
<td>The request contains validation errors</td>
</tr>
<tr>
<td><code>MISSING_REQUIRED_FIELD</code></td>
<td>400</td>
<td>A required field is missing</td>
</tr>
<tr>
<td><code>INVALID_FIELD_FORMAT</code></td>
<td>400</td>
<td>A field has an invalid format</td>
</tr>
<tr>
<td><code>INVALID_FIELD_VALUE</code></td>
<td>400</td>
<td>A field has an invalid value</td>
</tr>
<tr>
<td><code>INVALID_QUERY_PARAMETER</code></td>
<td>400</td>
<td>A query parameter is invalid</td>
</tr>
</tbody>
</table>
<h4 id="resource-errors">Resource Errors<a class="headerlink" href="#resource-errors" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Error Code</th>
<th>HTTP Status</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>RESOURCE_NOT_FOUND</code></td>
<td>404</td>
<td>The requested resource does not exist</td>
</tr>
<tr>
<td><code>RESOURCE_ALREADY_EXISTS</code></td>
<td>409</td>
<td>The resource already exists</td>
</tr>
<tr>
<td><code>RESOURCE_CONFLICT</code></td>
<td>409</td>
<td>The request conflicts with the current state</td>
</tr>
<tr>
<td><code>RESOURCE_GONE</code></td>
<td>410</td>
<td>The resource is no longer available</td>
</tr>
</tbody>
</table>
<h4 id="rate-limiting-errors">Rate Limiting Errors<a class="headerlink" href="#rate-limiting-errors" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Error Code</th>
<th>HTTP Status</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>RATE_LIMIT_EXCEEDED</code></td>
<td>429</td>
<td>The rate limit has been exceeded</td>
</tr>
</tbody>
</table>
<h4 id="server-errors">Server Errors<a class="headerlink" href="#server-errors" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Error Code</th>
<th>HTTP Status</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>INTERNAL_SERVER_ERROR</code></td>
<td>500</td>
<td>An unexpected error occurred</td>
</tr>
<tr>
<td><code>SERVICE_UNAVAILABLE</code></td>
<td>503</td>
<td>The service is temporarily unavailable</td>
</tr>
<tr>
<td><code>DATABASE_ERROR</code></td>
<td>500</td>
<td>A database error occurred</td>
</tr>
</tbody>
</table>
<h3 id="error-handling-implementation">Error Handling Implementation<a class="headerlink" href="#error-handling-implementation" title="Permanent link">&para;</a></h3>
<p>The API implements error handling using middleware and utility functions:</p>
<h4 id="error-middleware">Error Middleware<a class="headerlink" href="#error-middleware" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1">// middleware/errorHandler.js</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">errorHandler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Default to 500 Internal Server Error</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">statusCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">statusCode</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="mf">500</span><span class="p">;</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">errorCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">code</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;INTERNAL_SERVER_ERROR&#39;</span><span class="p">;</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;An unexpected error occurred&#39;</span><span class="p">;</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">details</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">details</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">{};</span>

<span class="w">  </span><span class="c1">// Handle specific error types</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;ValidationError&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Mongoose validation error</span>
<span class="w">    </span><span class="nx">statusCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">422</span><span class="p">;</span>
<span class="w">    </span><span class="nx">errorCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;VALIDATION_ERROR&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="nx">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Validation failed&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="nx">details</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">errors</span><span class="p">).</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">acc</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">acc</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">errors</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">message</span><span class="p">;</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">acc</span><span class="p">;</span>
<span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="p">{});</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;CastError&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Mongoose cast error (invalid ID)</span>
<span class="w">    </span><span class="nx">statusCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">400</span><span class="p">;</span>
<span class="w">    </span><span class="nx">errorCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;INVALID_FIELD_VALUE&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="nx">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`Invalid </span><span class="si">${</span><span class="nx">err</span><span class="p">.</span><span class="nx">path</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">code</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">11000</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// MongoDB duplicate key error</span>
<span class="w">    </span><span class="nx">statusCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">409</span><span class="p">;</span>
<span class="w">    </span><span class="nx">errorCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;RESOURCE_ALREADY_EXISTS&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="nx">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Duplicate entry&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">field</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">keyValue</span><span class="p">)[</span><span class="mf">0</span><span class="p">];</span>
<span class="w">    </span><span class="nx">details</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">field</span><span class="p">,</span>
<span class="w">      </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">keyValue</span><span class="p">[</span><span class="nx">field</span><span class="p">]</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// Log server errors</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">statusCode</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">500</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Server error:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// Send error response</span>
<span class="w">  </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="nx">statusCode</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span>
<span class="w">    </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">code</span><span class="o">:</span><span class="w"> </span><span class="nx">errorCode</span><span class="p">,</span>
<span class="w">      </span><span class="nx">message</span><span class="p">,</span>
<span class="w">      </span><span class="nx">details</span><span class="p">,</span>
<span class="w">      </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">path</span><span class="p">,</span>
<span class="w">      </span><span class="nx">timestamp</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">(),</span>
<span class="w">      </span><span class="nx">requestId</span><span class="o">:</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="c1">// Added by request ID middleware</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">};</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">errorHandler</span><span class="p">;</span>
</code></pre></div>

<h4 id="custom-error-classes">Custom Error Classes<a class="headerlink" href="#custom-error-classes" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1">// utils/errors.js</span>
<span class="kd">class</span><span class="w"> </span><span class="nx">ApiError</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">statusCode</span><span class="p">,</span><span class="w"> </span><span class="nx">code</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">details</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{})</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">super</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">statusCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">statusCode</span><span class="p">;</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">code</span><span class="p">;</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">details</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">details</span><span class="p">;</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
<span class="w">    </span><span class="ne">Error</span><span class="p">.</span><span class="nx">captureStackTrace</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span><span class="w"> </span><span class="nx">BadRequestError</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">ApiError</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;BAD_REQUEST&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">details</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{})</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">super</span><span class="p">(</span><span class="mf">400</span><span class="p">,</span><span class="w"> </span><span class="nx">code</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">details</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span><span class="w"> </span><span class="nx">UnauthorizedError</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">ApiError</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Authentication required&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;UNAUTHORIZED&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">details</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{})</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">super</span><span class="p">(</span><span class="mf">401</span><span class="p">,</span><span class="w"> </span><span class="nx">code</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">details</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span><span class="w"> </span><span class="nx">ForbiddenError</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">ApiError</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Access denied&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;FORBIDDEN&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">details</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{})</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">super</span><span class="p">(</span><span class="mf">403</span><span class="p">,</span><span class="w"> </span><span class="nx">code</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">details</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span><span class="w"> </span><span class="nx">NotFoundError</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">ApiError</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Resource&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;RESOURCE_NOT_FOUND&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">details</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{})</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">super</span><span class="p">(</span><span class="mf">404</span><span class="p">,</span><span class="w"> </span><span class="nx">code</span><span class="p">,</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">resource</span><span class="si">}</span><span class="sb"> not found`</span><span class="p">,</span><span class="w"> </span><span class="nx">details</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span><span class="w"> </span><span class="nx">ConflictError</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">ApiError</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Resource conflict&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;RESOURCE_CONFLICT&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">details</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{})</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">super</span><span class="p">(</span><span class="mf">409</span><span class="p">,</span><span class="w"> </span><span class="nx">code</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">details</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span><span class="w"> </span><span class="nx">ValidationError</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">ApiError</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Validation failed&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">details</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{})</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">super</span><span class="p">(</span><span class="mf">422</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;VALIDATION_ERROR&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">details</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span><span class="w"> </span><span class="nx">RateLimitError</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">ApiError</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Rate limit exceeded&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">details</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{})</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">super</span><span class="p">(</span><span class="mf">429</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;RATE_LIMIT_EXCEEDED&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">details</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">ApiError</span><span class="p">,</span>
<span class="w">  </span><span class="nx">BadRequestError</span><span class="p">,</span>
<span class="w">  </span><span class="nx">UnauthorizedError</span><span class="p">,</span>
<span class="w">  </span><span class="nx">ForbiddenError</span><span class="p">,</span>
<span class="w">  </span><span class="nx">NotFoundError</span><span class="p">,</span>
<span class="w">  </span><span class="nx">ConflictError</span><span class="p">,</span>
<span class="w">  </span><span class="nx">ValidationError</span><span class="p">,</span>
<span class="w">  </span><span class="nx">RateLimitError</span>
<span class="p">};</span>
</code></pre></div>

<h4 id="usage-in-route-handlers">Usage in Route Handlers<a class="headerlink" href="#usage-in-route-handlers" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1">// Example route handler with error handling</span>
<span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">NotFoundError</span><span class="p">,</span><span class="w"> </span><span class="nx">ValidationError</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../utils/errors&#39;</span><span class="p">);</span>

<span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/pigs/:id&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="mf">10</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Validate ID</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">isNaN</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ValidationError</span><span class="p">(</span><span class="s1">&#39;Invalid pig ID&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Must be a number&#39;</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Find pig by ID</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">pig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">Pig</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span><span class="w"> </span><span class="nx">pigId</span><span class="o">:</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// Check if pig exists</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">pig</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">NotFoundError</span><span class="p">(</span><span class="s1">&#39;Pig&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;PIG_NOT_FOUND&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">pigId</span><span class="o">:</span><span class="w"> </span><span class="nx">id</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Return pig data</span>
<span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">pig</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Pass error to error handling middleware</span>
<span class="w">    </span><span class="nx">next</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">});</span>
</code></pre></div>

<h3 id="error-logging-and-monitoring">Error Logging and Monitoring<a class="headerlink" href="#error-logging-and-monitoring" title="Permanent link">&para;</a></h3>
<p>All errors are logged and monitored:</p>
<ol>
<li><strong>Development Environment</strong>:</li>
<li>Detailed error information is logged to the console</li>
<li>
<p>Stack traces are included in logs</p>
</li>
<li>
<p><strong>Production Environment</strong>:</p>
</li>
<li>Errors are logged to a structured logging system</li>
<li>Critical errors trigger alerts</li>
<li>
<p>Error metrics are collected for monitoring</p>
</li>
<li>
<p><strong>Error Tracking</strong>:</p>
</li>
<li>Integration with error tracking services (e.g., Sentry)</li>
<li>Grouping of similar errors</li>
<li>Tracking of error frequency and impact</li>
</ol>
<h3 id="client-side-error-handling-recommendations">Client-Side Error Handling Recommendations<a class="headerlink" href="#client-side-error-handling-recommendations" title="Permanent link">&para;</a></h3>
<p>Clients should implement the following error handling strategies:</p>
<ol>
<li><strong>HTTP Status Code Handling</strong>:</li>
<li>Handle different status codes appropriately</li>
<li>
<p>Implement retry logic for 5xx errors</p>
</li>
<li>
<p><strong>Error Code Parsing</strong>:</p>
</li>
<li>Parse the <code>error.code</code> field for programmatic handling</li>
<li>
<p>Display user-friendly messages based on error codes</p>
</li>
<li>
<p><strong>Validation Error Handling</strong>:</p>
</li>
<li>Map validation errors to form fields</li>
<li>
<p>Display field-specific error messages</p>
</li>
<li>
<p><strong>Rate Limit Handling</strong>:</p>
</li>
<li>Implement exponential backoff for rate limit errors</li>
<li>
<p>Parse rate limit headers to adjust request timing</p>
</li>
<li>
<p><strong>Authentication Error Handling</strong>:</p>
</li>
<li>Redirect to login page for 401 errors</li>
<li>Clear invalid tokens from storage</li>
</ol>
<h3 id="example-error-responses">Example Error Responses<a class="headerlink" href="#example-error-responses" title="Permanent link">&para;</a></h3>
<h4 id="validation-error-422-unprocessable-entity">Validation Error (422 Unprocessable Entity)<a class="headerlink" href="#validation-error-422-unprocessable-entity" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;error&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;code&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;VALIDATION_ERROR&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Validation failed&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;details&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Name is required&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;age&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Age must be a positive number&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Invalid email format&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/api/pigs&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2023-06-15T10:30:45.123Z&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;requestId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;req-123456&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="resource-not-found-404-not-found">Resource Not Found (404 Not Found)<a class="headerlink" href="#resource-not-found-404-not-found" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;error&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;code&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PIG_NOT_FOUND&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Pig not found&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;details&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;pigId&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1001</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/api/pigs/1001&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2023-06-15T10:30:45.123Z&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;requestId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;req-123456&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="authentication-error-401-unauthorized">Authentication Error (401 Unauthorized)<a class="headerlink" href="#authentication-error-401-unauthorized" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;error&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;code&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;TOKEN_EXPIRED&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Token has expired&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/api/farms&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2023-06-15T10:30:45.123Z&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;requestId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;req-123456&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="rate-limit-error-429-too-many-requests">Rate Limit Error (429 Too Many Requests)<a class="headerlink" href="#rate-limit-error-429-too-many-requests" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;error&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;code&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RATE_LIMIT_EXCEEDED&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Rate limit exceeded&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;details&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;retryAfter&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">60</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;limit&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;remaining&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;reset&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1623760800</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/api/auth/login&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2023-06-15T10:30:45.123Z&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;requestId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;req-123456&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="api-versioning">API Versioning<a class="headerlink" href="#api-versioning" title="Permanent link">&para;</a></h2>
<p>The current API version is v1, which is implicit in the base URL. Future versions would be accessed via:</p>
<div class="codehilite"><pre><span></span><code>http://localhost:8080/api/v2/...
</code></pre></div>

<h2 id="cross-origin-resource-sharing-cors">Cross-Origin Resource Sharing (CORS)<a class="headerlink" href="#cross-origin-resource-sharing-cors" title="Permanent link">&para;</a></h2>
<p>The API supports CORS with the following configuration:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">CORS_CONFIG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">origin</span><span class="o">:</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">CORS_ORIGIN</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;*&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">methods</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;POST&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;PUT&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;DELETE&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;OPTIONS&#39;</span><span class="p">],</span>
<span class="w">  </span><span class="nx">allowedHeaders</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Authorization&#39;</span><span class="p">]</span>
<span class="p">};</span>
</code></pre></div>

<p>In production, the <code>origin</code> would be restricted to specific domains.</p>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    2025-05-08
  </span>

    
    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/brodynelly/PAAL-Docs" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>